# Payment Setup - Simple Guide

## Payment Flow

1. ✅ User creates order → QR code generated
2. ✅ User scans QR code → Banking app auto-fills payment form
3. ⏳ User completes payment → Sepay webhook detects → Order marked complete

## Setup Required

### Step 1: Configure Merchant Bank Account

**Option A: Environment Variables (Recommended)**

In Vercel → Settings → Environment Variables, add:

```
MERCHANT_BANK_NAME=Vietcombank
MERCHANT_BANK_ACCOUNT=1234567890
MERCHANT_BANK_OWNER=Your Company Name
```

**Option B: Admin Bank Info**

Add bank account info in Wallet page (as admin user). System will auto-detect.

### Step 2: Configure Sepay Webhook

In Sepay Dashboard → WebHooks:
- URL: `https://app.nobleco.vn/api/sepay/webhook`
- Event: "Có tiền vào" (Money In)
- Auth: API Key = `[REDACTED-SEPAY-API-KEY]`

### Step 3: Configure Payment Code Recognition

In Sepay Dashboard → Công ty → Cấu hình chung → Cấu trúc mã thanh toán:
- Set pattern to recognize order numbers (e.g., "ORD-2024-*")

## How It Works

1. **QR Code:** Generated by Sepay's API (`https://qr.sepay.vn/img`) with:
   - Bank account number
   - Amount
   - Payment code (order number) in description

2. **Payment:** User scans → Banking app auto-fills → User confirms

3. **Detection:** Sepay monitors bank account → Detects payment code → Sends webhook

4. **Completion:** Webhook updates order status → Commissions processed

## Bank Account Must Match

⚠️ **Important:** The bank account in:
- Vercel env vars (or admin bank info)
- Sepay dashboard (connected account)

**Must be the SAME account** for webhooks to work!

